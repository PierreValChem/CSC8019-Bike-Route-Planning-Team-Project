<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HERE Interactive Map with Routing</title>

    <!-- HERE Maps API -->
    <script src="https://js.api.here.com/v3/3.1/mapsjs-core.js"></script>
    <script src="https://js.api.here.com/v3/3.1/mapsjs-service.js"></script>
    <script src="https://js.api.here.com/v3/3.1/mapsjs-ui.js"></script>
    <script src="https://js.api.here.com/v3/3.1/mapsjs-mapevents.js"></script>

    <link rel="stylesheet" href="https://js.api.here.com/v3/3.1/mapsjs-ui.css" />

    <style>
        #mapContainer {
            width: 100%;
            height: 600px;
        }
        .controls {
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <h1>Bike Route Finder</h1>
    
    <div class="controls">
        <input type="text" id="startAddress" placeholder="Start Address">
        <input type="text" id="endAddress" placeholder="End Address">
        <button onclick="getRoute()">Find Route</button>
    </div>

    <div id="mapContainer"></div>

    <script>
        var platform = new H.service.Platform({
            'apikey': '3MHNRtsSj6qMMIoorPIiZWM48lhjVGAbkK7rONYOqMc'  // Replace with your HERE API Key
        });

        var defaultLayers = platform.createDefaultLayers();
        var map, behavior, ui, routingService;
        var startMarker, endMarker, routeLine;

        // Initialize map centered on user's location
        function initMap() {
            navigator.geolocation.getCurrentPosition(position => {
                map = new H.Map(
                    document.getElementById('mapContainer'),
                    defaultLayers.vector.normal.map,
                    {
                        zoom: 14,
                        center: { lat: position.coords.latitude, lng: position.coords.longitude }
                    }
                );

                ui = H.ui.UI.createDefault(map, defaultLayers);
                behavior = new H.mapevents.Behavior(new H.mapevents.MapEvents(map));

                routingService = platform.getRoutingService();
            }, () => {
                // Default to Berlin if location access is denied
                map = new H.Map(
                    document.getElementById('mapContainer'),
                    defaultLayers.vector.normal.map,
                    {
                        zoom: 10,
                        center: { lat: 52.5308, lng: 13.3847 }
                    }
                );

                ui = H.ui.UI.createDefault(map, defaultLayers);
                behavior = new H.mapevents.Behavior(new H.mapevents.MapEvents(map));
                routingService = platform.getRoutingService();
            });
        }

        function getRoute() {
            var startAddress = document.getElementById("startAddress").value;
            var endAddress = document.getElementById("endAddress").value;

            fetch('/get_route', {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ start_address: startAddress, end_address: endAddress })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    drawRoute(data.polyline);
                } else {
                    alert("No route found.");
                }
            });
        }

        function drawRoute(polyline) {
            if (routeLine) map.removeObject(routeLine); // Remove previous route

            var decodedPolyline = H.geo.LineString.fromFlexiblePolyline(polyline);
            routeLine = new H.map.Polyline(decodedPolyline, {
                style: { strokeColor: 'blue', lineWidth: 5 }
            });

            map.addObject(routeLine);
            map.getViewModel().setLookAtData({ bounds: routeLine.getBoundingBox() });
        }

        window.onload = initMap;
    </script>
</body>
</html>



